#%%
import numpy as np

def printt(string):
    print()
    print('=' * 40)
    print(string)
    print('=' * 40)
    print()

def interpolation(x1, y1, x2, y2, x):
    return y1 + (x - x1) * (y2 - y1) / (x2 - x1)

# ------------------------------------------------------------------
# Define inputs
# ------------------------------------------------------------------

M_1 = 2.5
delta = np.deg2rad(5)
alpha = np.deg2rad(3)
c = 0.2 # m
p_1 = 101325 # Pa
T_1 = 300 # K

#%%
# ------------------------------------------------------------------
printt('(1)')
# ------------------------------------------------------------------

p_o1__p_1 = 1.70859e+01
print(f'p_o1 / p_1: {p_o1__p_1:.4f}')

#%%
# ------------------------------------------------------------------
printt('(1) -> (2)')
# ------------------------------------------------------------------

theta_12 = delta - alpha

# (Appendix B)
beta_12 = np.deg2rad(25)

M_12n = M_1 * np.sin(beta_12)

# (A.2)
# 1.04000e+00 1.09520e+00 1.06709e+00 1.02634e+00 9.99923e-01 1.98442e+00 9.62025e-01
# 1.06000e+00 1.14420e+00 1.10092e+00 1.03931e+00 9.99751e-01 2.03245e+00 9.44445e-01
p_2__p_1 = interpolation(1.04000e+00, 1.09520e+00,
                         1.06000e+00, 1.14420e+00,
                         M_12n)

p_o2__p_o1 = interpolation(1.04000e+00, 9.99923e-01, 
                           1.06000e+00, 9.99751e-01,
                           M_12n)

M_2n = interpolation(1.04000e+00, 9.62025e-01,
                     1.06000e+00, 9.44445e-01,
                     M_12n)


M_2 = M_2n / np.sin(beta_12 - theta_12)

# (A.1)
# 2.40000e+00 1.46200e+01 6.79369e+00 2.15200e+00 2.40310e+00
# 2.45000e+00 1.58061e+01 7.18296e+00 2.20050e+00 2.51683e+00
p_o2__p_2 = interpolation(2.40000e+00, 1.46200e+01,
                          2.45000e+00, 1.58061e+01,
                          M_2)

print(f'M_12n: {M_12n:.4f}')
print(f'p_2 / p_1: {p_o2__p_o1:.4f}')
print(f'p_o2 / p_o1: {p_2__p_1:.4f}')
print(f'M_2n: {M_2n:.4f}')
print(f'M_2: {M_2:.4f}')
print(f'p_o2 / p_2: {p_o2__p_2:.4f}')
print(f'p_2 / p_1: {p_2__p_1:.4f}')

#%%
# ------------------------------------------------------------------
printt('(2) -> (3)')
# ------------------------------------------------------------------

theta_23 = 2 * delta

# (A.5)
# 2.40000e+00 3.67465e+01 2.46243e+01
# 2.45000e+00 3.79459e+01 2.40895e+01
nu_2 = interpolation(2.40000e+00, 3.67465e+01,
                     2.45000e+00, 3.79459e+01,
                     M_2)

nu_3 = nu_2 + np.rad2deg(theta_23)

# (A.5)
# 2.85000e+00 4.67779e+01 2.05410e+01
# 2.90000e+00 4.77903e+01 2.01713e+01
M_3 = interpolation(4.67779e+01, 2.85000e+00,
                    4.77903e+01, 2.90000e+00,
                    nu_3)

# (A.1)
# 2.85000e+00 2.92862e+01 1.11588e+01 2.62450e+00 3.67072e+00
# 2.90000e+00 3.15941e+01 1.17800e+01 2.68200e+00 3.84977e+00
p_o3__p_3 = interpolation(2.85000e+00, 2.92862e+01,
                          2.90000e+00, 3.15941e+01,
                          M_3)

p_3__p_1 = (1 / p_o3__p_3) * p_o2__p_o1 * p_o1__p_1

print(f'nu_2: {nu_2:.4f}')
print(f'nu_3: {nu_3:.4f}')
print(f'M_3: {M_3:.4f}')
print(f'p_o3 / p_3: {p_o3__p_3:.4f}')
print(f'p_3 / p_1: {p_3__p_1:.4f}')

#%%
# ------------------------------------------------------------------
printt('(1) -> (4)')
# ------------------------------------------------------------------

theta_14 = delta + alpha

# (Appendix B)
beta_14 = np.deg2rad(30)

M_14n = M_1 * np.sin(beta_14)

# (A.2)
# 1.24000e+00 1.62720e+00 1.41116e+00 1.15309e+00 9.88359e-01 2.52629e+00 8.18301e-01
# 1.26000e+00 1.68553e+00 1.44599e+00 1.16566e+00 9.85677e-01 2.58753e+00 8.07085e-01
p_4__p_1 = interpolation(1.24000e+00, 1.62720e+00,
                         1.26000e+00, 1.68553e+00,
                         M_14n)

p_o4__p_o1 = interpolation(1.24000e+00, 9.88359e-01,
                           1.26000e+00, 9.85677e-01,
                           M_14n)

M_4n = interpolation(1.24000e+00, 8.18301e-01,
                     1.26000e+00, 8.07085e-01,
                     M_14n)

M_4 = M_4n / np.sin(beta_14 - theta_14)

# (A.1)
# 2.15000e+00 9.88810e+00 5.13801e+00 1.92450e+00 1.91854e+00
# 2.20000e+00 1.06927e+01 5.43329e+00 1.96800e+00 2.00497e+00
p_o4__p_4 = interpolation(2.15000e+00, 9.88810e+00,
                          2.20000e+00, 1.06927e+01,
                          M_4)

p_4__p_1 = (1 / p_o4__p_4) * p_o1__p_1

print(f'M_14n: {M_14n:.4f}')
print(f'p_4 / p_1: {p_o4__p_o1:.4f}')
print(f'p_o4 / p_o1: {p_4__p_1:.4f}')
print(f'M_4n: {M_4n:.4f}')
print(f'M_4: {M_4:.4f}')
print(f'p_o4 / p_4: {p_o4__p_4:.4f}')
print(f'p_4 / p_1: {p_4__p_1:.4f}')

#%%
# ------------------------------------------------------------------
printt('(4) -> (5)')
# ------------------------------------------------------------------

theta_45 = 2 * delta

# (A.5)
# 2.15000e+00 3.04253e+01 2.77177e+01
# 2.20000e+00 3.17325e+01 2.70357e+01
nu_4 = interpolation(2.15000e+00, 3.04253e+01,
                     2.20000e+00, 3.17325e+01,
                     M_4)

nu_5 = nu_4 + np.rad2deg(theta_45)

# (A.5)
# 2.55000e+00 4.02798e+01 2.30888e+01
# 2.60000e+00 4.14147e+01 2.26199e+01
M_5 = interpolation(4.02798e+01, 2.55000e+00,
                    4.14147e+01, 2.60000e+00,
                    nu_5)

# (A.1)
# 2.55000e+00 1.84662e+01 8.02704e+00 2.30050e+00 2.76301e+00
# 2.60000e+00 1.99540e+01 8.48386e+00 2.35200e+00 2.89598e+00
p_o5__p_5 = interpolation(2.55000e+00, 1.84662e+01,
                          2.60000e+00, 1.99540e+01,
                          M_5)

p_5__p_1 = (1 / p_o5__p_5) * p_o4__p_o1 * p_o1__p_1

print(f'nu_4: {nu_4:.4f}')
print(f'nu_5: {nu_5:.4f}')
print(f'M_5: {M_5:.4f}')
print(f'p_o5 / p_5: {p_o5__p_5:.4f}')
print(f'p_5 / p_1: {p_5__p_1:.4f}')

#%%
# ------------------------------------------------------------------
printt('Drag & lift')
# ------------------------------------------------------------------

t = 2 * np.tan(delta) * (c / 2)

Axial = p_1 * (t / 2) * (p_2__p_1 + p_4__p_1 - p_3__p_1 - p_5__p_1)
Normal = p_1 * (c / 2) * (p_4__p_1 + p_5__p_1 - p_2__p_1 - p_3__p_1)

Lift = Normal * np.cos(alpha) - Axial * np.sin(alpha)
Drag = Normal * np.sin(alpha) + Axial * np.cos(alpha)

print(f'thickness: {t:.4f}')
print(f'Axial pressure [Pa]: {Axial:.2f}')
print(f'Normal pressure [Pa]: {Normal:.2f}')
print(f'Lift: {Lift:.2f}')
print(f'Drag: {Drag:.2f}')


#%%
# ------------------------------------------------------------------
printt('Moment')
# ------------------------------------------------------------------

N_2 = - (c / 2) * p_1 * p_2__p_1
N_3 = - (c / 2) * p_1 * p_3__p_1
N_4 = + (c / 2) * p_1 * p_4__p_1
N_5 = + (c / 2) * p_1 * p_5__p_1

A_2 = + (t / 2) * p_1 * p_2__p_1
A_3 = - (t / 2) * p_1 * p_3__p_1
A_4 = + (t / 2) * p_1 * p_4__p_1
A_5 = - (t / 2) * p_1 * p_5__p_1

x_2 = + c / 4
y_2 = + (c / 4) * np.tan(delta)
x_3 = + 3 * c / 4
y_3 = + (c / 4) * np.tan(delta)
x_4 = + c / 4
y_4 = - (c / 4) * np.tan(delta)
x_5 = + 3 * c / 4
y_5 = - (c / 4) * np.tan(delta)


M_LE = x_2 * N_2 - y_2 * A_2 + \
       x_3 * N_3 - y_3 * A_3 + \
       x_4 * N_4 - y_4 * A_4 + \
       x_5 * N_5 - y_5 * A_5

CoP_chord = M_LE / Normal
print(f'M_LE: {M_LE:.2f}')
print(f'CoP (chord): {CoP_chord:.2f}')

#%%